<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBJECTIF R1P</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --primary: #F7931E;
            --primary-hover: #e08215;
            --bg-color: #0a0f1c;
            --card-bg: rgba(15, 23, 42, 0.7);
            --text-main: #ffffff;
            --text-muted: #94a3b8;
            --danger: #ef4444;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at top, #162032, var(--bg-color));
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* Conteneurs avec effet Glassmorphism */
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 40px;
            border-radius: 24px;
            width: 90%;
            max-width: 420px;
            text-align: center;
            border: 1px solid rgba(247, 147, 30, 0.3);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            transition: all 0.4s ease;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.5s forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            font-weight: 800;
            margin-bottom: 10px;
            font-size: 1.8rem;
        }

        p {
            color: var(--text-muted);
            margin-bottom: 20px;
            font-size: 1rem;
        }

        input {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: 2px solid transparent;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 20px;
            transition: border 0.3s ease;
            outline: none;
        }

        input:focus {
            border: 2px solid var(--primary);
            background: rgba(255, 255, 255, 0.1);
        }

        button {
            background: var(--primary);
            color: #000;
            border: none;
            padding: 16px 40px;
            border-radius: 9999px;
            font-size: 1.1rem;
            font-weight: 800;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        button:hover {
            background: var(--primary-hover);
            transform: scale(1.02);
        }

        button:active {
            transform: scale(0.98);
        }

        button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .btn-outline {
            background: transparent;
            color: var(--text-muted);
            border: 1px solid var(--text-muted);
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 0.9rem;
        }

        .btn-outline:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            border-color: white;
        }

        #login-error {
            color: var(--danger);
            margin-top: 15px;
            font-weight: 600;
            min-height: 24px; /* Ã‰vite les sauts de mise en page */
        }

        #main-app {
            display: none; /* MasquÃ© par dÃ©faut */
        }

        .team-badge {
            background: rgba(247, 147, 30, 0.2);
            color: var(--primary);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
            margin-top: 10px;
            border: 1px solid var(--primary);
        }

        /* Toast Notification */
        #toast {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: #22c55e;
            color: white;
            padding: 16px 32px;
            border-radius: 9999px;
            font-weight: bold;
            box-shadow: 0 10px 25px rgba(34, 197, 94, 0.4);
            transition: bottom 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 1000;
        }
        #toast.show {
            bottom: 40px;
        }
    </style>
</head>
<body>

    <div id="login-modal" class="card">
        <h2>OBJECTIF R1P</h2>
        <p>Identifie-toi pour accÃ©der Ã  ton espace :</p>
        <input id="prenom-input" type="text" placeholder="Sofia, Kevin, Merwan..." autocomplete="off" />
        <button onclick="validatePrenom()">COMMENCER L'AVENTURE</button>
        <div id="login-error"></div>
    </div>

    <div id="main-app" class="card">
        <h2>Salut <span id="user-name"></span> ! ðŸ‘‹</h2>
        <div class="team-badge" id="user-team"></div>
        
        <button id="r1p-btn" onclick="takeR1P()" style="margin-top: 40px; padding: 20px; font-size: 1.4rem;">
            ðŸ”¥ R1P +1
        </button>

        <button class="btn-outline" onclick="logout()">Changer d'utilisateur</button>
    </div>

    <div id="toast">âœ… Objectif R1P validÃ© !</div>

    <script>
        // 1. Initialisation de Supabase (Correction du "s" minuscule)
        const SUPABASE_URL = "https://ydcfjlogsbkmzzzkxvgo.supabase.co";
        const SUPABASE_ANON_KEY = "sb_publishable_zVqdL4T9-J9srWE88bAskQ_Pjqb75Fz";
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // 2. DonnÃ©es de l'Ã©quipe
        const TEAM_MAP = {
            "sofia":"Ã‰quipe de Caen", "david":"Ã‰quipe de Caen", "kevin":"Ã‰quipe de Caen",
            "durmus":"Ã‰quipe d'Evreux", "merwan":"Ã‰quipe de Courbevoie",
            "diassivi":"Ã‰quipe de Courbevoie", "sertag":"Ã‰quipe de Courbevoie", "roxanne":"Ã‰quipe de Rouen"
        };

        // 3. Ã‰lÃ©ments du DOM
        const loginModal = document.getElementById("login-modal");
        const mainApp = document.getElementById("main-app");
        const prenomInput = document.getElementById("prenom-input");
        const errorMsg = document.getElementById("login-error");
        const r1pBtn = document.getElementById("r1p-btn");
        const toast = document.getElementById("toast");

        // 4. VÃ©rifier si l'utilisateur est dÃ©jÃ  connectÃ© au chargement
        window.onload = () => {
            const savedUser = localStorage.getItem("r1p_user");
            if (savedUser) {
                showApp(savedUser, TEAM_MAP[savedUser.toLowerCase()]);
            } else {
                prenomInput.focus();
            }
        };

        // 5. Validation Ã  l'appui de la touche "EntrÃ©e"
        prenomInput.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                validatePrenom();
            }
        });

        // 6. Fonction de connexion
        function validatePrenom() {
            let prenom = prenomInput.value.trim().toLowerCase();
            errorMsg.textContent = ""; // Reset de l'erreur
            
            if (!prenom) {
                errorMsg.textContent = "Veuillez entrer un prÃ©nom.";
                return;
            }

            if (!TEAM_MAP[prenom]) {
                errorMsg.textContent = "PrÃ©nom non reconnu dans l'Ã©quipe.";
                // Petite animation d'erreur (shake)
                loginModal.style.transform = "translateX(10px)";
                setTimeout(() => loginModal.style.transform = "translateX(-10px)", 100);
                setTimeout(() => loginModal.style.transform = "translateX(0)", 200);
                return;
            }

            // Sauvegarde dans le navigateur
            localStorage.setItem("r1p_user", prenom);
            showApp(prenom, TEAM_MAP[prenom]);
        }

        // 7. Affichage de l'interface principale
        function showApp(prenom, team) {
            const nameFormatted = prenom.charAt(0).toUpperCase() + prenom.slice(1);
            document.getElementById("user-name").textContent = nameFormatted;
            document.getElementById("user-team").textContent = team;

            loginModal.style.display = "none";
            mainApp.style.display = "block";
            
            // Relance l'animation d'apparition
            mainApp.style.animation = 'none';
            mainApp.offsetHeight; /* trigger reflow */
            mainApp.style.animation = null; 
        }

        // 8. Action Principale (R1P)
        async function takeR1P() {
            const user = localStorage.getItem("r1p_user");
            
            // UX : Ã‰tat de chargement du bouton
            r1pBtn.disabled = true;
            r1pBtn.innerHTML = "â³ Envoi en cours...";

            try {
                // EXEMPLE : Futur code Supabase (Ã  dÃ©commenter quand la table existera)
                /*
                const { error } = await supabaseClient
                    .from('r1p_logs')
                    .insert([{ user_name: user, created_at: new Date() }]);
                
                if (error) throw error;
                */

                // Simulation de l'attente rÃ©seau (500ms)
                await new Promise(resolve => setTimeout(resolve, 500));

                showToast();

            } catch (error) {
                console.error("Erreur Supabase:", error);
                alert("Une erreur est survenue lors de l'envoi.");
            } finally {
                // UX : Retour Ã  l'Ã©tat normal
                r1pBtn.disabled = false;
                r1pBtn.innerHTML = "ðŸ”¥ R1P +1";
            }
        }

        // 9. Afficher la notification Toast
        function showToast() {
            toast.classList.add("show");
            setTimeout(() => {
                toast.classList.remove("show");
            }, 3000); // DisparaÃ®t aprÃ¨s 3 secondes
        }

        // 10. DÃ©connexion
        function logout() {
            localStorage.removeItem("r1p_user");
            prenomInput.value = "";
            mainApp.style.display = "none";
            loginModal.style.display = "block";
            prenomInput.focus();
        }
    </script>
</body>
</html>
